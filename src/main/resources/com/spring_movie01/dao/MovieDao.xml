<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.spring_movie01.dao.MovieDao"> 
				<!-- Dao가 있는 패키지.Dao명 -->
  	<select id="selectMovieList" resultType="com.spring_movie01.dto.MovieDto">
  		<!-- id : Dao가 호출되는 메소드명 / resultType : resultSet에 담기는 것을 어느 객체로 담을지-->
  		SELECT MVCODE,MVNAME,MVPD,MVACTOR,MVGENRE,MVAGE,MVTIME,TO_CHAR(MVOPEN,'YYYY.MM.DD') AS MVOPEN,MVPOSTER 
  		FROM MOVIES
  		ORDER BY MVCODE
 	 </select>

	<select id="selectMovieInfo" resultType="com.spring_movie01.dto.MovieDto">
		SELECT MVCODE,MVNAME,MVPD,MVACTOR,MVGENRE,MVAGE,MVTIME,TO_CHAR(MVOPEN,'YYYY.MM.DD') AS MVOPEN,MVPOSTER
		FROM MOVIES
		WHERE MVCODE=#{mvcode}
	</select>
	
	<select id="selectReserveMvList" resultType="com.spring_movie01.dto.MovieDto">
		SELECT *
		FROM MOVIES
		WHERE MVCODE IN (SELECT SCMVCODE FROM SCHEDULES)
	</select>
	
	<select id="selectReservThList" resultType="com.spring_movie01.dto.TheaterDto">
		SELECT THCODE, THNAME
		FROM THEATERS
		WHERE THCODE IN (SELECT SCTHCODE FROM SCHEDULES WHERE SCMVCODE=#{mvcode})
	</select>
	
	<select id="getScDay" resultType="com.spring_movie01.dto.SchedulesDto">
		SELECT TO_CHAR(SCDATE,'YYYY.MM.DD') AS SCDAY
		FROM SCHEDULES
		WHERE SCMVCODE=#{mvcode} AND SCTHCODE=#{thcode}
		GROUP BY TO_CHAR(SCDATE,'YYYY.MM.DD')
		ORDER BY SCDAY
	</select>
	
	<select id="getScTime" resultType="com.spring_movie01.dto.SchedulesDto">
		SELECT TO_CHAR(SCDATE,'HH24:MI') AS SCTIME,SCROOM
		FROM SCHEDULES
		WHERE SCMVCODE=#{mvcode} AND SCTHCODE=#{thcode} AND TO_CHAR(SCDATE,'YYYY.MM.DD')=#{scday}
		ORDER BY SCROOM
	</select>
	
	<insert id="insertReservation">
		INSERT INTO RESERVATION(RECODE, REMID, RESCTHCODE, RESCROOM, RESCDATE, REAMOUNT)
		VALUES(#{recode}, #{remid}, #{rescthcode}, #{rescroom}, TO_DATE(#{rescdate},'YYYY.MM.DD HH24:MI'), #{reamount})
	</insert>

</mapper>